# Gmail API 設定指南

本指南將幫助您設定 Gmail API，以便應用程式可以讀取 Gmail 郵件並自動匯入帳單。

## 步驟 1: 啟用 Gmail API

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 選擇您的專案（或創建新專案）
3. 前往「API 和服務」→「程式庫」
4. 搜尋「Gmail API」
5. 點擊「啟用」

## 步驟 2: 設定 OAuth 同意畫面

1. 前往「API 和服務」→「OAuth 同意畫面」
2. 選擇「外部」（如果是個人專案）或「內部」（如果是 Google Workspace）
3. 填寫應用程式資訊：
   - **應用程式名稱**：記帳助手（或您喜歡的名稱）
   - **使用者支援電子郵件**：您的電子郵件
   - **應用程式標誌**：（可選）
   - **應用程式首頁連結**：`https://final-lac-alpha.vercel.app`
   - **應用程式隱私權政策連結**：（可選，但建議提供）
   - **應用程式服務條款連結**：（可選）
   - **已授權網域**：`vercel.app` 和 `final-lac-alpha.vercel.app`
4. 點擊「儲存並繼續」

## 步驟 3: 設定範圍（Scopes）

1. 在「範圍」頁面，點擊「新增或移除範圍」
2. 手動新增以下範圍：
   - `https://www.googleapis.com/auth/gmail.readonly`（Gmail 唯讀存取）
3. 點擊「更新」→「儲存並繼續」

## 步驟 4: 設定測試使用者（測試階段）

如果應用程式還在測試階段，需要添加測試使用者：

1. 在「測試使用者」頁面，點擊「新增使用者」
2. 輸入要測試的 Google 帳號電子郵件（例如：`da36720889@gmail.com`）
3. 點擊「新增」
4. 點擊「儲存並繼續」

## 步驟 5: 將應用程式設為公開（正式使用）

**重要**：如果您的應用程式要供所有用戶使用，需要將應用程式設為公開：

1. 在「OAuth 同意畫面」中，點擊「發佈應用程式」
2. 確認要發佈應用程式
3. 注意：發佈應用程式需要通過 Google 的驗證程序（可能需要幾天時間）

### 快速解決方案（測試階段）

如果只是測試，可以暫時使用「測試使用者」：

1. 前往「OAuth 同意畫面」→「測試使用者」
2. 添加所有需要使用應用程式的 Google 帳號
3. 這些帳號就可以正常使用應用程式了

## 步驟 6: 更新 OAuth 2.0 憑證

1. 前往「API 和服務」→「憑證」
2. 確認您的 OAuth 2.0 用戶端 ID 已設定正確的重新導向 URI：
   - `https://final-lac-alpha.vercel.app/api/auth/callback/google`
   - `http://localhost:3000/api/auth/callback/google`（開發環境）

## 步驟 7: 驗證設定

1. 清除瀏覽器快取和 Cookie
2. 前往 `https://final-lac-alpha.vercel.app/auth/signin`
3. 點擊「使用 Google 登入」
4. 應該會看到授權畫面，請求以下權限：
   - 查看您的電子郵件地址
   - 查看您的個人資料
   - **查看您的 Gmail 郵件（唯讀）** ← 這是新增的權限
5. 點擊「允許」

## 常見問題

### Q: 出現「access_denied」錯誤
**A:** 這表示應用程式還在測試階段，且您的帳號不在測試使用者列表中。請按照「步驟 4」添加測試使用者。

### Q: 如何知道應用程式是否已發佈？
**A:** 在「OAuth 同意畫面」中，如果看到「發佈應用程式」按鈕，表示尚未發佈。如果看到「取消發佈」，表示已發佈。

### Q: 發佈應用程式需要多久？
**A:** Google 的驗證程序通常需要 1-7 個工作日。在驗證期間，只能使用測試使用者。

### Q: 可以跳過驗證直接發佈嗎？
**A:** 如果您的應用程式是個人使用或小範圍使用，可以暫時不發佈，只使用測試使用者功能。

## 測試清單

- [ ] Gmail API 已啟用
- [ ] OAuth 同意畫面已設定
- [ ] Gmail 讀取權限已添加到範圍
- [ ] 測試使用者已添加（或應用程式已發佈）
- [ ] OAuth 憑證的重新導向 URI 已設定
- [ ] 可以成功登入並授權 Gmail 存取
- [ ] Dashboard 中可以看到「Gmail 自動匯入」卡片
- [ ] 可以成功檢查並匯入 Gmail 帳單

