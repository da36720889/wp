# 群組分帳功能使用指南

## 功能概述

群組分帳功能允許在 LINE 群組中計算大家出的錢以及各需給其他人多少，計算完的錢可以直接匯入到個人記帳中，分別顯示「xx群組出資」和「xx群組回收」。

## 使用步驟

### 1. 建立群組分帳

在 LINE 群組中輸入：
```
/group new [總金額] [描述]
```

**範例：**
```
/group new 1000 晚餐
```

這會建立一個總金額為 1000 元、描述為「晚餐」的群組分帳。

### 2. 記錄每個人的出資

每個參與者輸入自己實際支付的金額：
```
/group add [金額]
```

**範例：**
```
/group add 300
```

這表示您實際出了 300 元。

### 3. 設定每個人的分攤金額

每個參與者輸入自己應該分攤的金額：
```
/group split [金額]
```

**範例：**
```
/group split 250
```

這表示您應該分攤 250 元。

### 4. 查看分帳狀態

查看當前分帳狀態和轉帳建議：
```
/group list
```

這會顯示：
- 總金額和描述
- 每個參與者的出資和分攤金額
- 應收/應付金額
- 分帳結果（誰該給誰多少錢）

### 5. 結算並匯入個人記帳

當所有人都設定好分攤金額後，建立者可以結算：
```
/group settle
```

這會：
1. 計算分帳結果（最小轉帳次數）
2. 為每個參與者創建「群組出資」記錄（實際支付的金額，類別：群組出資）
3. 為應收金額的參與者創建「群組回收」記錄（應收金額，類別：群組回收）
4. 所有記錄會自動匯入到個人記帳中

## 範例場景

假設三人聚餐，總共 1000 元：

1. **建立分帳：**
   ```
   /group new 1000 聚餐
   ```

2. **記錄出資：**
   - 小明：`/group add 500`（實際出了 500 元）
   - 小華：`/group add 300`（實際出了 300 元）
   - 小美：`/group add 200`（實際出了 200 元）

3. **設定分攤：**
   - 小明：`/group split 333.33`（應分攤 333.33 元）
   - 小華：`/group split 333.33`（應分攤 333.33 元）
   - 小美：`/group split 333.34`（應分攤 333.34 元）

4. **查看狀態：**
   ```
   /group list
   ```
   
   顯示結果：
   - 小明：出資 500 元，分攤 333.33 元（應收 166.67 元）
   - 小華：出資 300 元，分攤 333.33 元（應付 33.33 元）
   - 小美：出資 200 元，分攤 333.34 元（應付 133.34 元）
   
   分帳結果：
   - 小華 → 小明：33.33 元
   - 小美 → 小明：133.34 元

5. **結算：**
   ```
   /group settle
   ```
   
   結算後，每個人的記帳中會出現：
   - **小明：**
     - 支出：500 元（類別：群組出資，描述：群組出資 - 聚餐）
     - 收入：166.67 元（類別：群組回收，描述：群組回收 - 聚餐）
   - **小華：**
     - 支出：300 元（類別：群組出資，描述：群組出資 - 聚餐）
     - 支出：33.33 元（類別：群組出資，描述：群組出資 - 聚餐）
   - **小美：**
     - 支出：200 元（類別：群組出資，描述：群組出資 - 聚餐）
     - 支出：133.34 元（類別：群組出資，描述：群組出資 - 聚餐）

## 注意事項

1. **僅在群組中使用：** 群組分帳功能只能在 LINE 群組中使用，不能在個人聊天中使用。

2. **建立者權限：** 只有建立分帳的人可以執行 `/group settle` 結算。

3. **分攤金額必須設定：** 結算前，所有參與者都必須設定分攤金額（使用 `/group split`）。

4. **自動匯入記帳：** 結算後，所有記錄會自動匯入到個人記帳中，可以在 Web 界面查看。

5. **群組標記：** 匯入的記錄會標記為群組分帳相關，類別為「群組出資」或「群組回收」。

## 指令列表

| 指令 | 說明 | 範例 |
|------|------|------|
| `/group new [總金額] [描述]` | 建立新分帳 | `/group new 1000 晚餐` |
| `/group add [金額]` | 記錄您的出資 | `/group add 300` |
| `/group split [金額]` | 設定您的分攤 | `/group split 250` |
| `/group list` | 查看分帳狀態 | `/group list` |
| `/group settle` | 結算並匯入記帳 | `/group settle` |
| `/group help` | 顯示詳細說明 | `/group help` |

## 技術細節

- **分帳算法：** 使用最小轉帳次數算法，確保轉帳次數最少。
- **數據存儲：** 分帳記錄存儲在 MongoDB 中，與個人記帳記錄關聯。
- **自動同步：** 結算後的記錄會自動同步到 Web 界面，無需手動操作。

